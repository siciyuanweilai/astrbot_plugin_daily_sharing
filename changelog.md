### v4.6.1

1. Gitee AI Image 深度集成：新增了对 astrbot_plugin_gitee_aiimg 新版本的支持，并新增了**形象参考图逻辑**，允许 Bot 使用预设的参考图进行“图生图”来保持生活照的一致性。
2. 昵称与日程逻辑强化，强制 LLM 检查日程中是否包含用户昵称，防止 Bot 在和用户聊天时把用户当成第三人称（例如日程是“和张三吃饭”，Bot 对张三说“我今天要去和张三吃饭”的语病）。
3. 插件加载健壮性：优化了查找其他插件实例的逻辑，兼容 AstrBot 不同的加载状态。
4. 新增独立定时分享每天60s读懂世界、AI资讯快报，支持LLM触发。
5. 新增排除周一和周日定时分享AI资讯快报，源头没有数据。
6. 新增夸克热搜。
7. 新增知识和推荐的内容库自定义。
8. 重写深度回溯获取聊天历史记录逻辑。
9. 新增指定LLM生成内容失败后自动降级使用默认的第一个模型逻辑。
10. 修复了奇奇怪怪的BUG。

### v4.0.0
**🚀 架构级升级：原生适配与性能重构**

**1. ⚡️ 异步数据库架构**
*   **重构**：引入数据库管理，全面重写底层存储逻辑。
*   **性能**：所有 SQLite 操作（读写历史、状态更新）均放入独立线程池执行。
*   **效果**：彻底杜绝了因数据库 I/O 导致的 Bot 主线程卡顿，即使历史记录达到数万条也能秒级响应。

**2. 🔗 原生上下文注入**
*   **对话历史注入**：适配 AstrBot 的上下文新接口。
    *   **变更前**：Bot 发送的每日分享是“孤立”的消息，不被 LLM 记忆，导致用户回复“展开讲讲”时 Bot 一脸懵逼。
    *   **变更后**：插件会伪造一组“隐形对话”（User: 请发送分享 -> Bot: [分享内容]）写入历史记录。
    *   **效果**：完美保持上下文连贯性，Bot 能基于刚才分享的内容继续与用户深入聊天。

**3. 👁️ 深度上下文感知**
*   **深度分页策略**：重写聊天历史消息获取逻辑。
    *   打破了仅获取最近 20 条消息的限制，现在支持**深度回溯**（默认24小时聊天历史消息）。
    *   采用分批轮询机制，确保在群聊消息量巨大时也能准确抓取上下文。
*   **群聊态势感知**：新增群聊热度分析算法。
    *   统计短时间内的有效消息数、活跃人数。
    *   计算 **聊天热度**：Bot 现在知道群里是“死寂”、“闲聊”还是“激烈讨论”，并据此调整开场白的打扰程度。

**4. 🤖 零配置 Bot 发现**
*   **智能初始化**：不再强制要求用户在配置文件中填写繁琐的平台适配器。
*   **逻辑**：插件启动时会自动扫描 AstrBot 加载的所有适配器，自动锁定可用的 Bot 实例。
*   **效果**：开箱即用，极大降低了新手配置门槛。

### v3.0.0
**🧠 核心升级：全链路 Agent 化**

**重构 配图生成逻辑：**
- 新增 `_agent_extract_visuals` 思考链路，引入 JSON 结构化提取。
- 智能仲裁“文案 vs 日程”的地点冲突，减少“图文不符”的幻觉。

**重构 选题与情感逻辑：**
- 新增 **选题 Agent**：结合历史记录“头脑风暴”出新颖的冷知识，自动去重。
- 新增 **情感分析 Agent**：基于全文理解判断 TTS 语音情感（happy/sad/angry）。

**🕒 细粒度时间管理**
- 新增 **“深夜 (Late Night)”** 时段（22-24点），文案强制带晚安，配图光影转为幽暗风格。

### v2.0.0 
**⚡️ 架构升级：异步任务流**
- 将生成与发送逻辑剥离为后台 `asyncio.create_task`，彻底解决因绘图/TTS耗时过长导致的 LLM 工具调用超时问题。
- **✨ 新增 AI 视频生成**：支持将生成的静态配图转换为 5秒 动态视频，让 Bot 的“早安”动起来。

### v1.0.0 
**🌱 初始发布**
- 支持 Cron 定时任务、时间段感知、多模态（图/文/音）内容生成、全网热搜聚合。

**多模态内容生成：**
- 📝 智能文案：基于 LLM 生成，集成 Life Scheduler（天气/穿搭/日程）和 聊天历史，拒绝尴尬开场。
- 🎨 智能配图：根据文案自动生成绘画提示词。支持从生活上下文中提取“穿搭”信息，智能判断是否需要人物出镜（画人 vs 画景）。
- 🗣️ 情感语音：集成 TTS 插件，根据分享类型和时间段自动注入情绪（happy/sad/neutral/angry）。