# 📅 astrbot_plugin_daily_sharing (定时主动分享所见所闻)

<div align="center">

**赋予你的 Bot “生活感” —— 基于时间、场景、记忆的主动分享插件**

</div>

## 📖 简介

**Daily Sharing** 是一个为 AstrBot 设计的高级主动交互插件。它不仅仅是一个定时发送器，而是让你的 Bot 像真人一样，根据 **当前时间段**、**生活状态 (Life Context)**、**聊天记忆 (Chat History)** 和 **网络热点**，向指定的好友或群组分享内容。

它能够：
- 🌅 **早安问候**：结合当天的天气、Bot 的虚拟行程来打招呼。
- 📰 **热点分享**：自动获取知乎、微博、B站等平台热搜，并发表“个人”看法。
- 🎨 **AI 配图**：自动生成符合当前场景的配图（支持从生活上下文中提取穿搭、智能判断是否出镜）。
- 🧠 **上下文感知**：知道群里是否在热烈讨论（避免插嘴），记得上次和用户聊了什么。

## ✨ 核心特性

### 1. ⏰ 智能时段与序列调度
- **Cron 定时**：内置多种预设（如 `morning` 早安, `twice` 早晚各一次）或自定义 Cron 表达式。
- **序列轮换**：不同时段执行不同的分享逻辑。
  - *示例*：早上先发“问候”，如果由于冷却未触发，下次可能发“新闻”。
  - *逻辑*：`早晨(06-12)` 偏向问候与新闻，`深夜(20-24)` 偏向心情与晚安。

### 2. 🧠 深度上下文集成 (Context Aware)
- **生活状态**：联动 `life_scheduler`，Bot 会说“今天下雨了，我刚出门...”而不是生硬的“早上好”。
- **聊天记忆**：联动 `memos_integrator`，私聊时 Bot 会尝试延续上次的话题；群聊时会自动分析群热度（High/Low），热度过高时自动静默，避免打断群友施法。

### 3. 📰 多源热点聚合
- **支持平台**：知乎、微博、B站、小红书、抖音（需配置 API Key）。
- **智能偏好**：基于时间段自动选择最合适的源。
  - *早上*：偏向 **小红书/知乎**（晨间阅读）。
  - *下午/深夜*：偏向 **抖音/B站**（娱乐摸鱼）。
- **降级策略**：主源获取失败会自动尝试备用源，API 全挂则使用 LLM 兜底生成。

### 4. 🎨 智能 AI 配图
- **场景感知**：Bot 分享“心情”时画“自拍/人物”，分享“新闻”时画“场景/空镜”（LLM 智能判断）。
- **穿搭提取**：自动从 `life_scheduler` 的上下文中提取 Bot 当天的穿搭（如“白色毛衣”），确保画中形象与人设一致。
- **环境光影**：自动根据时间（清晨/黄昏/深夜）调整画面的光影提示词。

## 📥 安装与依赖

### 1. 通过 AstrBot 插件市场安装
1. 在 AstrBot WebUI 中打开插件市场
2. 搜索 `astrbot_plugin_daily_sharing`
3. 点击安装

### 2. 推荐依赖 (可选但强烈建议)
为了获得完整体验，建议安装以下插件：

| 插件名称 | 作用 | 缺失影响 |
| :--- | :--- | :--- |
| **astrbot_plugin_life_scheduler** | 提供 Bot 的虚拟生活日程、天气、穿搭信息 | 分享内容将缺少“生活感”细节，配图无法固定穿搭 |
| **astrbot_plugin_memos_integrator** | 提供长短期记忆支持 | 无法引用最近的聊天话题，无法记录分享历史到记忆中 |
| **astrbot_plugin_gitee_aiimg** | 提供 AI 绘图能力 | 无法发送配图 |

## ⚙️ 配置说明

请在 AstrBot 管理面板的 **插件配置** 中进行可视化设置（无需修改代码）。

### 👥 推送目标设置 (receiver)
*   **适配器ID**：你的 Bot 适配器 ID（通常是 `aiocqhttp` 或 `qq_official`）。
*   **群聊列表**：点击添加，输入需要自动分享的 **群号**。
*   **私聊列表**：点击添加，输入需要自动分享的 **QQ号**。

### ⏰ 基础与定时设置 (basic_conf)
*   **sharing_cron**: 定时规则。推荐使用预设 `twice` (早8点+晚8点) 或自定义 cron。
*   **sharing_type**: 推荐设为 `auto`，插件会根据内置的【时段序列】自动在 问候/新闻/心情/知识/推荐 之间轮换。

### 📰 新闻热榜设置 (news_conf)
*   **enable_news_api**: 开启后获取真实热搜。
*   **nycnm_api_key**: **(推荐)** 柠柚API [<sup>4</sup>](https://api.nycnm.cn/) 密钥。如果不填，将无法获取真实热搜数据。
*   **news_random_mode**: 建议选 `time_based` (基于时间智能选择) 或 `config` (在指定列表中随机)。

### 🎨 配图与发送设置 (image_conf)
*   **enable_ai_image**: 是否开启配图（需安装绘图插件）。
*   **appearance_prompt**: Bot 的外貌描述（如 `silver hair, blue eyes`），留空则自动从人设 Prompt 中提取。
*   **separate_text_and_image**: 推荐开启，文字和图片分两条消息发送，模拟真人手速。

## 🎮 指令列表

指令前缀取决于你的全局配置（通常是 `/`）。
**注意：以下指令仅限管理员使用。**

| 指令 | 参数 | 说明 |
| :--- | :--- | :--- |
| `/分享` | `状态` | 查看插件运行状态、下一次分享类型、最近记录等 |
| `/分享` | `[类型]` | 立即手动触发一次分享。<br>类型可选：`问候`, `新闻`, `心情`, `知识`, `推荐`, `自动` |
| `/分享` | `开启` | 启用自动分享定时任务 |
| `/分享` | `关闭` | 禁用自动分享定时任务 |
| `/分享` | `查看序列` | 查看当前时段的轮换序列 |
| `/分享` | `重置序列` | 重置发送序列索引（回到第一个类型） |
| `/分享` | `帮助` | 查看指令帮助菜单 |

**示例：**
- `/分享 新闻` (立即发一条新闻)
- `/分享 状态` (看看下一次什么时候发)

## 🧩 效果示例

### 场景 1：早安问候 (私聊)
> **Context**: Bot 的生活日程显示正在吃早餐，天气晴朗。
>
> **Bot**: 🌅 早上好呀！今天阳光超级好，我正在吃刚烤好的吐司呢~ 🥪 又是元气满满的一天，记得吃早饭哦！
> **[图片]**: (一张阳光明媚的早餐桌，Bot 穿着家居服的自拍，光影为 Morning Light)

### 场景 2：晚间新闻 (群聊)
> **Context**: 群里刚讨论完游戏，API 获取到“某游戏发布新预告”。
>
> **Bot**: 📺 忙里偷闲刚在 B站 看到【黑神话·悟空】的新演示，特效真的太强了！🔥 这里有同样在等的伙伴吗？感觉国产游戏真的站起来了！
> **[图片]**: (一张游戏风格的场景图，Bot 坐在电脑前的背影，**不包含正脸**)

### 场景 3：群聊防打扰
> **Context**: 群里 10 分钟内有 50 条消息，判定为 `High Intensity`。
>
> **Log**: `[DailySharing] 因策略跳过群组 123456 (chat_intensity: high)`
> **Result**: 插件跳过本次分享，避免打断群友聊天。

## 🛠️ 常见问题

**Q: 为什么 Bot 不发图？**
A: 1. 请确认安装了 `astrbot_plugin_gitee_aiimg`。2. 在配置中开启了 `enable_ai_image`。3. 检查后台日志是否有 LLM 生成 Prompt 失败的记录。

**Q: 为什么 Bot 说的新闻是假的？**
A: 请检查是否配置了 `nycnm_api_key`。如果没有 API Key 或 Key 失效，新闻获取模块会关闭，若 LLM 强行生成新闻可能会出现幻觉。

**Q: 设置了定时任务但没有触发？**
A: 使用 `/分享 状态` 查看 Cron 是否生效。如果显示“禁用”，请使用 `/分享 开启`。另外，插件有 5 秒防抖锁，避免重复触发。