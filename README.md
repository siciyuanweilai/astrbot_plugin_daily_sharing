# 📅 astrbot_plugin_daily_sharing (定时主动分享所见所闻)

<div align="center">

**赋予你的 Bot “生活感” —— 集成视觉、听觉、记忆的全感官主动分享插件**

</div>

## 📖 简介

**Daily Sharing** 是为 AstrBot 打造的旗舰级主动交互插件。它打破了 Bot "被动回复" 的限制，让 Bot 像真人一样，根据 **当前时间**、**生活状态**、**聊天记忆** 和 **网络热搜**，主动向你分享生活点滴。

它不仅仅是发文字，更能**发语音、发自拍、看热搜**，是打造 "有灵魂" 的 AI 伴侣的核心组件。

## ✨ 核心特性

### 1. 🗣️ 情感化 TTS 语音
*   **情绪感知**：自动分析文案内容，智能匹配语音情绪。
*   **混合发送**：支持 "图+文+语音" 混合推送，或 "纯语音+图" 模式，模拟真人发语音条的习惯。

### 2. 🎨 智能 AI 绘图与构图
*   **穿搭同步**：联动 `life_scheduler`，自动从 Bot 的生活日程中提取当天的穿搭，确保画中人物形象与设定一致。
*   **构图判断**：集成 LLM 视觉顾问，智能判断画什么：
    *   分享心情/问候 -> **画人物**（自拍、肖像）。
    *   分享新闻/推荐 -> **画场景**（书桌、咖啡厅、物品），避免无关人物乱入。
*   **环境光影**：自动根据物理时间（清晨/黄昏/深夜）调整画面的光影 Prompt，杜绝 "半夜窗外是大太阳" 的违和感。

### 3. 📰 智能热点聚合
*   **多源支持**：知乎、微博、B站、小红书、抖音（需配置 API Key）。
*   **时段偏好算法**：
    *   🌅 **早晨**：偏向 **小红书/知乎**（晨间轻阅读）。
    *   🌆 **傍晚**：偏向 **B站/微博**（下班吃瓜）。
    *   🌃 **深夜**：偏向 **抖音**（娱乐摸鱼）。
*   **自动降级**：主源获取失败会自动尝试备用源，全网瘫痪则使用 LLM 知识库兜底。

### 4. 🧠 深度上下文感知 (Context Aware)
*   **生活状态**：Bot 会说 "刚吃完早餐，今天好冷啊"，而不是生硬的 "早上好"。
*   **记忆延续**：联动 `memos`，私聊时尝试延续上次的话题。
*   **KY 规避**：群聊时自动分析**聊天热度**。如果群友正在热火朝天地讨论，Bot 会保持安静，避免 "插嘴" 造成的尴尬。

### 5. ⏰ 灵活的调度策略
*   **时段序列**：不同时间段执行不同的逻辑（早晨发问候，下午发推荐，晚上发心情）。
*   **Cron 支持**：内置预设（`morning`, `twice`）或完全自定义 Cron 表达式。

## 🧩 推荐插件生态

本插件可以独立运行，但强烈建议安装以下插件以获得完整体验：

| 插件名称 | 必需性 | 作用 | 缺失影响 |
| :--- | :--- | :--- | :--- |
| **astrbot_plugin_life_scheduler[<sup>链接</sup>](https://github.com/muyouzhi6/astrbot_plugin_life_scheduler)** | ⭐⭐⭐⭐⭐ | 提供虚拟生活、天气、穿搭 | 分享内容缺少生活细节，配图无法固定穿搭 |
| **astrbot_plugin_memos_integrator[<sup>链接</sup>](https://github.com/zz6zz666/astrbot_plugin_memos_integrator)** | ⭐⭐⭐⭐ | 提供记忆存储与检索 | 无法引用历史话题，无法记录分享历史 |
| **astrbot_plugin_gitee_aiimg[<sup>链接</sup>](https://github.com/muyouzhi6/astrbot_plugin_gitee_aiimg)** | ⭐⭐⭐⭐ | 提供 AI 绘图能力 | 无法发送配图 |
| **astrbot_plugin_tts_emotion_router[<sup>链接</sup>](https://github.com/muyouzhi6/astrbot_plugin_tts_emotion_router)** | ⭐⭐⭐⭐ | 提供情感语音合成 | 无法发送语音消息 |

## ⚙️ 配置指南

请在 AstrBot WebUI 的 **插件配置** 面板中进行设置。

### 1. 基础与推送 (Basic & Receiver)
*   **推送目标**：填入需要自动推送的群号或 QQ 号。
*   **sharing_cron**：定时规则，推荐 `twice` (早8点+晚8点)。
*   **sharing_type**：推荐 `auto`，让插件根据时间自动轮换分享类型。

### 2. 新闻源 (News)
*   **nycnm_api_key**：**(重要)** 前往 柠柚 API [<sup>点击前往</sup>](https://api.nycnm.cn/) 获取密钥。不填则无法获取真实热搜，仅能依靠 LLM 瞎编。
*   **news_random_mode**：推荐 `time_based`，启用上述的“时段偏好算法”。

### 3. 视觉与听觉 (Image & TTS)
*   **image_conf -> enable_ai_image**：开启配图。
*   **image_conf -> separate_text_and_image**：开启后图文分开发送，更像真人。
*   **tts_conf -> enable_tts**：开启语音。
*   **tts_conf -> prefer_audio_only**：开启后，如果语音生成成功，将**不再发送文字**（仅发语音+图），沉浸感更强。

## 🎮 指令列表

> 指令仅限管理员使用。

| 指令 | 参数 | 说明 |
| :--- | :--- | :--- |
| `/分享` | `[类型]` | 立即手动触发一次。<br>类型：`问候`, `新闻`, `心情`, `知识`, `推荐`, `自动` |
| `/分享` | `状态` | 查看下一次运行时间、Cron 规则、历史记录 |
| `/分享` | `开启` / `关闭` | 启停自动定时任务 |
| `/分享` | `查看序列` | 查看当前时间段（如早晨）会轮换发什么内容 |
| `/分享` | `重置序列` | 重置轮换顺序，回到列表开头 |

## 🌰 效果示例

#### 场景：早安问候 (私聊，全功能开启)
> **Context**: LifeScheduler 显示正在喝咖啡，穿米色毛衣。TTS 判定情绪为 Happy。
>
> **Bot (语音消息 🔊 8s)**: "早安呀！今天的阳光太棒了，我刚冲好咖啡，你也记得吃早餐哦！"
> **Bot (图片)**: [一张阳光明媚的特写，Bot 穿着米色毛衣手拿咖啡，光影为 Morning Light]

#### 场景：晚间新闻 (群聊)
> **Context**: 此时是 20:00，根据偏好选择了 **B站热搜**。
>
> **Bot (文字)**: "📺 忙里偷闲刷了下 B站，【黑神话·悟空】的新演示太燃了吧！🔥 那个打击感真的绝了，有人一起蹲首发吗？"
> **Bot (图片)**: [一张游戏风格的场景渲染图，Bot 坐在电脑前的背影，**无正脸**]

#### 场景：群聊静默 (防打扰)
> **Context**: 群里 5 分钟内刷了 99+ 条消息。
>
> **Log**: `[DailySharing] 监测到群聊热度过高 (High Intensity)，跳过本次主动分享。`
> **(Bot 保持沉默，不打断群友施法)**

## 🛠️ 常见问题

**Q: 为什么不开 AI 画图也会有图片描述？**
A: 如果你开启了 Memos 记录，插件会将生成的 Prompt 存入记忆，以便 Bot "记得" 自己发过什么图，即使图片没有真正生成。

**Q: 为什么语音没有情绪？**
A: 请检查日志中 `[DailySharing] 已注入 TTS 情绪状态` 是否出现。具体的情绪演绎效果取决于你 TTS 插件所使用的模型（如 GPT-SoVITS 效果最佳）。

**Q: 总是发一样的新闻源？**
A: 检查 `news_random_mode` 是否设为了 `fixed`。改为 `time_based` 或 `random` 可增加多样性。