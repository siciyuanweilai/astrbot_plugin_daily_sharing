
# 📅 astrbot_plugin_daily_sharing (定时主动分享所见所闻)

<div align="center">

**赋予你的 Bot “生活感” —— 基于时间、场景、记忆的主动分享插件**

</div>

## 📖 简介

**Daily Sharing** 是一个为 AstrBot 设计的高级主动交互插件。它不仅仅是一个定时发送器，而是让你的 Bot 像真人一样，根据时间段、生活状态（Life Context）、聊天记忆（Chat History）和网络热点，向指定的好友或群组分享内容。

它能够：
- 🌅 **早安问候**：结合当天的天气、Bot 的虚拟行程来打招呼。
- 📰 **热点分享**：自动获取知乎、微博、B站等平台热搜，并发表“个人”看法。
- 🎨 **AI 配图**：根据分享内容自动生成 AI 配图（支持智能判断是否需要人物出镜）。
- 🧠 **上下文感知**：知道群里是否在热烈讨论（避免插嘴），记得上次和用户聊了什么。

## ✨ 核心特性

*   **⏰ 智能时段调度**
    *   支持 Cron 表达式或预设模板（早安、午间、晚间等）。
    *   **序列模式**：同一时段内可轮询不同类型的分享（例如：早上先问候，下次触发分享新闻）。
*   **🧠 深度上下文集成**
    *   **生活状态**：联动 `life_scheduler`，Bot 会说“今天天气好冷，我刚出门...”而不是生硬的问候。
    *   **聊天记忆**：联动 `memos_integrator`，Bot 会记得“上次我们聊到...”或根据群聊热度调整语气。
*   **📰 多源热点聚合**
    *   支持 **知乎、微博、B站、小红书、抖音** 热搜。
    *   **智能选择**：早上偏向深度阅读（知乎/小红书），晚上偏向娱乐（B站/抖音）。
    *   **降级策略**：API 失败时自动回退到 LLM 生成或备用源。
*   **🎨 智能 AI 配图**
    *   联动 `gitee_aiimg` 插件。
    *   **智能构图**：Bot 分享心情时画“自拍/人物”，分享新闻时画“场景/空镜”。
    *   **穿搭一致性**：根据当前时间段（白天/深夜）自动提取 Bot 的穿搭描述。
*   **🛡️ 群聊策略控制**
    *   **防打扰**：检测到群聊正在热烈讨论时，可自动跳过分享或简化内容。

## 📥 安装
### 通过 AstrBot 管理面板安装
1. 打开 AstrBot 管理面板。
2. 进入插件市场。
3. 搜索 `astrbot_plugin_daily_sharing` 进行安装。

### 2. 推荐依赖插件 (可选但强烈建议)
为了获得最佳体验，建议安装以下插件：

| 插件名称 | 作用 | 缺失影响 |
| :--- | :--- | :--- |
| **astrbot_plugin_life_scheduler** | 提供 Bot 的虚拟生活日程、天气、穿搭信息 | 分享内容将缺少“生活感”细节 |
| **astrbot_plugin_memos_integrator** | 提供长短期记忆支持 | 无法引用最近的聊天话题，无法判断群聊热度 |
| **astrbot_plugin_gitee_aiimg** | 提供 AI 绘图能力 | 无法发送配图 |

## ⚙️ 配置说明

安装后，请在 AstrBot 管理面板的 `插件配置` 中进行设置。

### 基础配置
*   **enable_auto_sharing**: 插件总开关。
*   **target_users**: **(必填)** 接收分享的用户/群组列表。
    *   格式示例：`QQ:FriendMessage:123456` (私聊) 或 `QQ:GroupMessage:654321` (群聊)。
*   **sharing_cron**: 定时规则。推荐使用预设 `twice` (早晚各一次) 或自定义 cron。
*   **sharing_type**: 推荐设为 `auto`，插件会根据时间段自动在 问候/新闻/心情/知识/推荐 之间轮换。

### 新闻配置
*   **enable_news_api**: 是否开启真实热搜。
*   **nycnm_api_key**: **(推荐)** 柠柚API密钥，用于获取真实热搜([https://api.nycnm.cn](https://api.nycnm.cn/))。如果不填，将由 LLM 编造新闻（不推荐）。
*   **news_random_mode**: 推荐 `config` 或 `time_based`，以获得多样化的新闻源。

### AI 配图配置
*   **enable_ai_image**: 是否开启配图。
*   **appearance_prompt**: Bot 的外貌描述（英文），留空则自动从人设中提取。
*   **separate_text_and_image**: 推荐开启，文字和图片分开发送，体验更像真人。

## 🎮 指令列表

以下指令仅限管理员使用：

| 指令 | 说明 |
| :--- | :--- |
| `/share_status` | 查看插件运行状态、下一次分享类型、历史记录等 |
| `/share_now [类型]` | 立即触发一次分享。可选类型：`greeting`, `news`, `mood`, `knowledge`, `recommendation` |
| `/share_enable` | 启用自动分享任务 |
| `/share_disable` | 禁用自动分享任务 |
| `/share_reset_sequence` | 重置分享序列（回到第一种类型） |
| `/share_sequence_status` | 查看当前时段的分享序列进度 |
| `/share_set_image_behavior` | 设置配图模式 (`auto`/`always`/`never`) |

## 🧩 效果示例

### 场景 1：早安问候 (私聊)
> **Context**: Bot 的生活日程显示正在吃早餐，天气晴朗。
>
> **Bot**: 🌅 早上好呀！今天阳光超级好，我正在吃刚烤好的吐司呢~ 🥪 你昨晚睡得好吗？今天要不要一起加油！
> **[图片]**: (一张阳光明媚的早餐桌，Bot 穿着家居服的自拍)

### 场景 2：晚间新闻 (群聊)
> **Context**: 群里刚讨论完游戏，现在比较安静。News API 获取到“某游戏发布新预告”。
>
> **Bot**: 📺 刚在B站看到【黑神话·悟空】的新演示，特效真的太强了！🔥 这里有同样在等的伙伴吗？感觉国产游戏真的站起来了！
> **[图片]**: (一张游戏风格的场景图，Bot 坐在电脑前的背影)

### 场景 3：群聊防打扰
> **Context**: 群里 3 分钟内有 50 条消息，正在热烈讨论。
>
> **Log**: `[DailySharing] Skip group 123456 due to strategy (chat_intensity: high)`
> **Result**: 插件跳过本次分享，避免打断群友聊天。

## 🛠️ 常见问题

**Q: 为什么 Bot 不发图？**
A: 请检查是否安装了 `gitee_aiimg` 插件，并在配置中开启了 `enable_ai_image`。

**Q: 为什么 Bot 说的新闻是假的？**
A: 请检查是否配置了 `nycnm_api_key`。如果没有 API Key，Bot 会使用 LLM 进行“创意生成”，内容可能不真实。

**Q: 如何获取 `target_users` 的 ID？**
A: 在 AstrBot 后台日志中查看，或者让 Bot 发送一条消息，查看后台的 UMO 标识。

